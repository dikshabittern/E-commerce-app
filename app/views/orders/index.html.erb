<%#= link_to "generate pdf", orders_history_path(format: :pdf) %>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.4.1/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.4.1/js/buttons.flash.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.4.1/js/buttons.html5.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.4.1/js/buttons.print.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css"></script>


<h4 class="order_header text-center">Orders History</h4><br>
<table class="table table-hover" id="example">
  <thead>
    <tr>
      <th>Product Name</th>
      <th>Date&Time</th>
      <th>Address</th>
      <th>Quantity</th>
      <th>Price</th>
      <th>Total</th>
      <th>Image</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>

    <% @orders.each do |order| %>
      <% order.cart.cart_items.each do |item| %>
      
        <tr>
          <td><%= item.product.name %></td>
          <td><%= Time.now.strftime "%a, %-d %b %Y %I:%M %p " %></td>
          <% @add = item.cart.user.addresses.first %>
          <td><%= @add.address %> <%= @add.country%> <%= @add. post_code%> <%= @add. district%> </td>
          <td><%= item.quantity %></td>
          <td><%= item.product.price || 0.0 %></td>
          <td><%= item.quantity * item.product.price %></td>
          <td><%= image_tag item.product.image.url(:thumb) %></td> 
        </tr>


      <% end %>
    <% end %>
  </tbody>
   </div>
    </div>
</table><br><br>



    
    <div class="float-right p-2 mb-2 bg-success text-white " style="margin-right: 3%" >
        Total Price:  <%#= @orders.cart.cart_items.map(&:unit_price).reject {|e| !e.present?}.sum %>
    </div>
    <div class="float-right p-2 mb-2 bg-success text-white " style="margin-right: 5%" >
      Total Quantity: <%#= @orders.cart.cart_items.map(&:quantity).reject {|e| !e.present?}.sum  %>&nbsp;&nbsp;
    </div>
    <br><br>
    
 
<script type="text/javascript">
  $('#example').DataTable({
    dom: 'Bfrtip',
    buttons: [
        'copy', 'excel', 'pdf', 'csv'
    ]
} );
</script>