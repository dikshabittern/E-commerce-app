<!-- <div class="grid"> --> 
  <%#= render 'products/sidebar_menu', locals: {categories: @categories} %>
  <%#= render partial: 'product_grid', locals: { products: @products} %>
<!-- </div> -->

<div class="container">
    <div class="card">
      <div class="container-fliud">
        <div class="wrapper row">
          <div class="preview col-md-6">
            <!-- <div class="preview-pic tab-content"> -->
              <div class="tab-pane active" id="pic-1"><img src="<%= @product.image %>" /></div>&nbsp;&nbsp;&nbsp;&nbsp;
            <!-- </div> -->
                 <!---------- Rating riview form -------------->
              <%# if current_user.present? %>
                <%#= form_for (RatingReview.new) do |f| %>
                  <%# if current_user.present? %>
                    <%#= f.hidden_field :user_id, value: current_user.id %>
                    <%#= f.hidden_field :product_id, value: @product.id %>
                   <%# end %>
                  
                  <!-- <div id="rating-form" class="field col-lg-12 from-group">
                    <label>Rating</label>
                  </div>

                  <div class="field col-lg-12 from-group">
                    <%#= f.label :review %>
                    <%#= f.text_area :review , :class => "form-control" %>
                  </div>

                  <div class="field col-lg-12 from-group text-center ">
                    <%#= f.submit "Submit", class: 'btn btn-success' %>
                  </div> -->
                  <!-- ------  Review script ----------- -->
                  <!-- <script type="text/javascript">
                    $('#rating-form').raty({
                      path: '/assets/',
                      scoreName: 'rating_review[rating]'
                    });
                  </script> -->
                <%# end %>
              <%# end %>
          </div>

          <div class="details col-md-6">
            <h3 class="product-title"><%= @product.name %></h3>
            <div class='star-rating' data-score=<%= @avg_rating %>></div>
                <strong><%= "#{@reviews.try(:size)} reviews" %></strong>

            <p class="product-description"><strong>Description:</strong> <%= @product.description %></p>
            <h4 class="price">current price:<span>₹ <%= @product.display_price %></span> <del><span>₹ <%= @product.display_full_price %></span></del>(<%= @product.discount_percentage.to_f.round(2)%>%)</h4>
            <p class="vote">
                <strong>Place Order: (<%= @orders.count %> times) </strong>
                <% @orders.each_with_index do |item, index| %>
                  <strong><%= item.user.name%></strong>
                <% end %><br>
                buyers enjoyed this product!
            </p>  
            <h5 class="sizes">sizes:
              <span class="size" data-toggle="tooltip" title="small">s</span>
              <span class="size" data-toggle="tooltip" title="medium">m</span>
              <span class="size" data-toggle="tooltip" title="large">l</span>
              <span class="size" data-toggle="tooltip" title="xtra large">xl</span>
            </h5>
            <h5 class="colors">colors:
              <span class="color orange not-available" data-toggle="tooltip" title="Not In store"></span>
              <span class="color green"></span>
              <span class="color blue"></span><br/><br/>
                <div class="action">
                   <button class="add-to-cart btn btn-default" type="button"><a href="/products/<%= @product.id %>/cart">add to cart</a></button>
                    <button class="btn btn-info" type="button"><a href="/">Back</a></button>
                    <button class="color green" type="button"><a href="/products/<%= @product.id %>/wishlist" ><i class="fa fa-shopping-bag"></i></a></button>
                </div>
            </h5>
            <div class="action">
              <!--  Product show rating  -->
              <br><br>
                <% @reviews.each do |review|%>
                  <div class='star-rating' data-score=<%= review.rating %>></div><br>
                  <%= review.review %>
                  <h6><%= review.user.name %></h6><hr>

                <% end %>
                <script>
                    $('.star-rating').raty({
                      path: '/assets/',
                      readOnly: true,
                      score: function() {
                            return $(this).attr('data-score');
                    }
                  });
                </script>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div><br>

<!-- <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css"> -->
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<!------ Include the above in your HEAD tag ---------->

<div class="container">
    <h4>Click the filter icon <small>(<i class="glyphicon glyphicon-filter"></i>)</small></h4>
      <div class="row">
      <div class="col-md-12">
        <div class="panel panel-success">
          <div class="panel-heading">
            <h3 class="panel-title">Place Order Details</h3>
            <div class="pull-right">
              <span class="clickable filter float-right" data-toggle="tooltip" title="Toggle table filter" data-container="body">
                <i class="glyphicon glyphicon-filter"></i>
              </span><br><br>
            </div>
          </div>
          <div class="panel-body">
            <input type="text" class="form-control" id="dev-table-filter" data-action="filter" data-filters="#dev-table" placeholder="Filter Developers" />
          </div>
          <table class="table table-hover table-bordered" id="dev-table">
            <thead>
              <tr>
                <th>Order Id</th>
                <th>Product</th>
                <th>Date&Time</th>
                <th>Address</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Total</th>
                <th>Image</th>
              </tr>
            </thead>
            <tbody>
              <% if current_user.present? %>
              <% if current_user.role == 'admin' %>
              <% if current_user.orders.present? %>
              <% @orders.each do |order| %>
                <tr>
                  <!-- <td><%#= order.created_at.strftime "%a, %-d %b %Y %I:%M %p" %></td> -->
                  <% order.cart.cart_items.each do |item| %>
                    <% product_id = item.product_id
                      product = Product.unscoped.find(product_id) %>
                      <% if product.present? %> 
                      <tr>
                        <td><b><%= order.id %></b></td>
                        <td><%= product.name rescue nil %></td>
                        <td><%= Time.now.strftime "%a, %-d %b %Y %I:%M %p" %></td>
                          <% address_id = order.address_id %>
                          <% @add = Address.find_by(id: address_id)%>
                        <% if @add.present? %>
                          <td><%= @add.address %>, <%= @add.country%>, <%= @add. post_code%>, <%= @add. district%> </td>
                        <% end %>
                        <td><%= item.quantity rescue nil %></td>
                        <td><%= product.price  || 0.0  rescue nil %></td>
                        <td><%= item.quantity * product.price  || 0.0 rescue nil  %></td>
                        <td><%= image_tag product.image.url(:thumb) rescue nil %></td> 
                      </tr>
                      <% end %>
                    <% end %>
                </tr>
              <% end %>
              <% end %>
              <% end %> 
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

   <style type="text/css">
    .row{
        margin-top:40px;
        padding: 0 10px;
    }
    .clickable{
        cursor: pointer;   
    }

    .panel-heading div {
      margin-top: -18px;
      font-size: 15px;
      color: green;
    }
    .panel-heading div span{
      margin-left:5px;
    }
    .panel-body{
      display: none;
    }

  </style>
  

  <script type="text/javascript">
    (function(){
      'use strict';
      var $ = jQuery;
      $.fn.extend({
    filterTable: function(){
      return this.each(function(){
        $(this).on('keyup', function(e){
          $('.filterTable_no_results').remove();
          var $this = $(this), 
                        search = $this.val().toLowerCase(), 
                        target = $this.attr('data-filters'), 
                        $target = $(target), 
                        $rows = $target.find('tbody tr');
                        
          if(search == '') {
            $rows.show(); 
          } else {
            $rows.each(function(){
              var $this = $(this);
              $this.text().toLowerCase().indexOf(search) === -1 ? $this.hide() : $this.show();
            })
            if($target.find('tbody tr:visible').size() === 0) {
              var col_count = $target.find('tr').first().find('td').size();
              var no_results = $('<tr class="filterTable_no_results"><td colspan="'+col_count+'">No results found</td></tr>')
              $target.find('tbody').append(no_results);
            }
          }
        });
      });
    }
  });
  $('[data-action="filter"]').filterTable();
})(jQuery);

$(function(){
    // attach table filter plugin to inputs
  $('[data-action="filter"]').filterTable();
  
  $('.container').on('click', '.panel-heading span.filter', function(e){
    var $this = $(this), 
      $panel = $this.parents('.panel');
    
    $panel.find('.panel-body').slideToggle();
    if($this.css('display') != 'none') {
      $panel.find('.panel-body input').focus();
    }
  });
  $('[data-toggle="tooltip"]').tooltip();
})
</script>

 
  

