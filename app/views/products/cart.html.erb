<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.4.1/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.4.1/js/buttons.flash.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.4.1/js/buttons.html5.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.4.1/js/buttons.print.min.js"></script>
<!-- <script src="https://js.stripe.com/v3/"></script> -->

<p id="notice"><%= notice %></p>
<h1 class="text-center">Carts</h1>
<!-- <script src="http://localhost/assets/js/ZeroClipboard.js"></script>  -->
<table class=" myTable table table-hover" id="cartpdf">
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
      <th>Image</th>
      <th>Category</th>
      <th>Quantity</th>
      <th>Price</th>
      <th></th>
      <th></th>
      <th>Place Order</th>
      <th colspan="4"></th>
    </tr>
  </thead>

  <tbody>
    <% if @products.present? %>
    <% @products.each do |product| %>
      <tr>
        <td><%= product.name %></td>
        <td><%= product.description %></td>
        <td><%= image_tag product.image.url(:thumb) %></td>
        <td><%= product.category.name %></td>
        <td>
          <%= form_with url: order_path, remote: true do |f| %>
              <!-- <td><%#= f.number_field :quantity, step: :any, :class => "num", :oninput => "calc()" %></td> -->
              <td><input class="num_<%=  product.id %>" type="text" oninput="calc()" autocomplete = "off" /></td>
              <td><span id="ticket_price_<%=  product.id %>"><%= product.price %></span>
                <p>Subtotal : <b>$<span class="total_<%=  product.id %>">0</span></b></p>
              </td>
              <td>
                <%= f.hidden_field :product_id, value: product.id  %>
                <%= f.submit "Place Order" %>
              </td>
              <td>
                <%#= button_to 'Checkout',  charges_path, :class => "btn btn-secondary" %>
                <%= link_to "Checkout", charges_path(product_id: product.id) %>
              </td>
              <td><%= link_to "Remove",  remove_cart_path(product), data: {method: :delete, remote: true}  %>
              </td> 
          <% end %>

          
   
<script type="text/javascript">
  function calc()
{
  debugger
  var p = "#{product.id}";
  var price = document.getElementById("ticket_price_p").innerHTML;
  var noTickets = document.getElementsByClassName("num_p")[0].value;
  var total = parseFloat(price) * noTickets
  if (!isNaN(total))
    document.getElementsByClassName("total_p").innerHTML = total
}
</script>



        </td>
      </div>
      </tr>
    <% end %>
    <% end %>
  </tbody>
</table><br>


    
    <div class="float-right p-2 mb-2 bg-success text-white " style="margin-right: 3%" >
      Total Price: <%= @products.map(&:price).sum %>
    </div>
    <div class="float-right p-2 mb-2 bg-success text-white " style="margin-right: 5%" >
      Total Quantity: <%= @products.count %>&nbsp;&nbsp;
    </div>
    <br><br>
    
    <div class="text-center ">
      <div class="btn-group">
        <%#= button_to 'Place Order', order_path(count: @products.count, product_id: @products.ids), :class => "btn btn-info" %>&nbsp;&nbsp;
        <%= button_to 'Checkout',  charges_path, :class => "btn btn-secondary" %>
      </div>
    </div>


<script type="text/javascript">
  $('#cartpdf').DataTable({
    dom: 'Bfrtip',
    buttons: [
        'copy', 'excel', 'pdf', 'csv'
    ]
} );
</script>



<!-- <div class="container">
  <input type="button" onclick="decrementValue()" value="-" />
  <input type="text" name="quantity" value="1" maxlength="2" max="10" size="1" id="number" />
  <input type="button" onclick="incrementValue()" value="+" />
</div>


<script type="text/javascript">
function incrementValue()
{
    var value = parseInt(document.getElementById('number').value, 10);
    value = isNaN(value) ? 0 : value;
    if(value<10){
        value++;
            document.getElementById('number').value = value;
    }
}
function decrementValue()
{
    var value = parseInt(document.getElementById('number').value, 10);
    value = isNaN(value) ? 0 : value;
    if(value>1){
        value--;
            document.getElementById('number').value = value;
    }

}
</script> -->




<!-- Increment decrement  -->
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<%#= form_with url: order_path, remote: true do |f| %>
  <input type="button" value="-" id="minus" />
  <input type="text" id="quantity" value="" name="quantity" />
  <input type="button" value="+" id="plus" />
  <br />
  <input id="total-price" readonly="readonly" value=""/>
<%# end %>

<script type="text/javascript">
  $('#plus').click(function add() {
  var $qtde = $("#quantity");
  var a = $qtde.val();

  a++;
  $("#minus").attr("disabled", !a);
  $qtde.val(a);
});
$("#minus").attr("disabled", !$("#quantity").val());

$('#minus').click(function minust() {
  var $qtde = $("#quantity");
  var b = $qtde.val();
  if (b >= 1) {
    b--;
    $qtde.val(b);
  } else {
    $("#minus").attr("disabled", true);
  }
});

/* On change */
$(document).ready(function() {
  function updatePrice() {
    var price = parseFloat($("#quantity").val());
    var total = (price + 1) * 1.05;
    var total = total.toFixed(2);
    $("#total-price").val(total);
  }
  // On the click of an input, update the price
  $(document).on("click", "input", updatePrice);
});
</script> -->

<!-- <script type="text/javascript">
  var stripe = Stripe('pk_test_WOuxu6ZZPDsPH6NEpxUYKagu00nMNIXrtl');
</script> -->

<!-- <script type="text/javascript">
  $(document).ready(function() {
    $('#example33').DataTable( {
        dom: 'Bfrtip',
        buttons: [
            {
                extend: 'pdfHtml5',
                orientation: 'landscape',
                pageSize: 'LEGAL'
            }
        ]
    } );
} );
</script> -->

<!-- <script type="text/javascript">
  
  $('#plus').click(function add() {
  var $qtde = $("#quantity");
  var a = $qtde.val();

  a++;
  $("#minus").attr("disabled", !a);
  $qtde.val(a);
});
$("#minus").attr("disabled", !$("#quantity").val());

$('#minus').click(function minust() {
  var $qtde = $("#quantity");
  var b = $qtde.val();
  if (b >= 1) {
    b--;
    $qtde.val(b);
  } else {
    $("#minus").attr("disabled", true);
  }
});

/* On change */
$(document).ready(function() {
  function updatePrice() {
    var price = parseFloat($("#quantity").val());
    var total = (price + 1) * 1.05;
    var total = total.toFixed(2);
    $("#total-price").val(total);
  }
  // On the click of an input, update the price
  $(document).on("click", "input", updatePrice);
});
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<input type="button" value="-" id="minus" />
<input type="text" id="quantity" value="" name="quantity" />
<input type="button" value="+" id="plus" />
<br />
<input id="total-price" readonly="readonly" value="" /> -->
<!-- 
<form id="confirmInfo" action="bookingsuccess.html">
  <p>Number of tickets :<input id="num" type="text" oninput="calc()" /> </p>
  <p>Price Per ticket : $<span id="ticket_price">7</span></p>
  <p>Booking fee : $2</p>
  <p>Subtotal : <b>$<span id="total">0</span></b></p>


  <form name="myform" action="bookingsuccess.php" method="post">
    <button>Book</button>
  </form>
  <button>Cancel</button>
</form> -->